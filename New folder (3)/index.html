<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For You, Nayanika</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --aurora-1: hsla(333, 70%, 55%, 0.4);
            --aurora-2: hsla(282, 82%, 54%, 0.3);
            --aurora-3: hsla(210, 89%, 60%, 0.3);
            --aurora-4: hsla(35, 90%, 60%, 0.3);
        }

        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden; /* Prevent horizontal scroll */
            background-color: #000; /* Pitch black start */
            color: #f3f4f6;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        /* --- INTRO OVERLAY --- */
        #intro-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1.5s ease-in-out;
        }
        
        .glow-point {
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 20px 10px rgba(255, 255, 255, 0.5);
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px 5px rgba(236, 72, 153, 0.2); transform: scale(1); }
            50% { box-shadow: 0 0 40px 15px rgba(236, 72, 153, 0.6); transform: scale(1.2); }
        }

        /* --- BACKGROUNDS --- */
        .aurora-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -3;
            background: 
                radial-gradient(circle at 15% 50%, var(--aurora-1), transparent 50%),
                radial-gradient(circle at 85% 30%, var(--aurora-2), transparent 50%),
                radial-gradient(circle at 50% 80%, var(--aurora-3), transparent 50%);
            background-size: 200% 200%;
            filter: blur(60px);
            animation: auroraFlow 15s ease-in-out infinite alternate;
            opacity: 0; /* Hidden initially */
            transition: opacity 2s ease;
        }

        #firefly-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            pointer-events: none;
        }

        #heart-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            opacity: 0;
            transition: opacity 2s ease;
        }

        @keyframes auroraFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- UI COMPONENTS --- */
        h1, h2, h3 { font-family: 'Playfair Display', serif; }

        .text-gradient {
            background: linear-gradient(135deg, #fff 0%, #fbcfe8 50%, #f472b6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: inline-block;
        }

        .glass-card {
            background: rgba(12, 10, 9, 0.65);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            opacity: 0; 
            transform: translateY(20px);
        }

        .modern-btn {
            background: linear-gradient(135deg, #db2777 0%, #e11d48 100%);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(219, 39, 119, 0.3);
        }
        
        .modern-btn::after {
            content: '';
            position: absolute;
            top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            opacity: 0; transform: scale(0.5);
            transition: opacity 0.3s, transform 0.3s;
        }

        .modern-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 0 40px rgba(219, 39, 119, 0.6);
        }
        .modern-btn:hover::after { opacity: 1; transform: scale(1); }

        /* --- POLAROID GALLERY --- */
        .memories-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 2rem;
            perspective: 1000px;
            margin-bottom: 2rem;
        }

        .polaroid-wrapper {
            cursor: pointer;
            transition: z-index 0.3s;
        }
        
        .polaroid-wrapper:hover {
            z-index: 50;
        }

        .polaroid-card {
            background: white;
            padding: 10px 10px 35px 10px;
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.3);
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out; /* Smooth tilt */
            width: 220px; /* Slightly smaller to fit multiple */
            position: relative;
        }

        /* Rotation variants for natural look */
        .polaroid-wrapper:nth-child(1) .polaroid-card { transform: rotate(-3deg); }
        .polaroid-wrapper:nth-child(2) .polaroid-card { transform: rotate(2deg) translateY(-10px); }
        .polaroid-wrapper:nth-child(3) .polaroid-card { transform: rotate(-2deg) translateY(10px); }
        .polaroid-wrapper:nth-child(4) .polaroid-card { transform: rotate(4deg); }

        .polaroid-card::before {
            content: '';
            position: absolute; top:0; left:0; right:0; bottom:0;
            background: rgba(255,255,255,0.4);
            opacity: 0; pointer-events: none; transition: opacity 0.4s ease; z-index: 10;
        }
        .polaroid-wrapper:hover .polaroid-card::before {
            animation: flash 0.5s ease-out forwards;
        }
        @keyframes flash { 0% {opacity: 0.6;} 100% {opacity: 0;} }

        .polaroid-img { aspect-ratio: 4/5; object-fit: cover; width: 100%; background-color: #eee; border: 1px solid #ddd; }
        .handwritten { font-family: 'Playfair Display', serif; font-style: italic; color: #1f2937; margin-top: 10px; font-size: 1rem; line-height: 1.2; }

        .step-container { display: none; }
        .step-container.active { display: flex; }

        /* Progress Bar */
        .progress-fill {
            background: linear-gradient(90deg, #ec4899, #ef4444);
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 15px rgba(236, 72, 153, 0.8);
        }

        .heart-beat { animation: beat 1.5s infinite; }
        @keyframes beat {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 10px rgba(236,72,153,0.4)); }
            50% { transform: scale(1.1); filter: drop-shadow(0 0 25px rgba(236,72,153,0.9)); }
        }

        .music-control {
            position: fixed; bottom: 20px; right: 20px; z-index: 50;
            background: rgba(255,255,255,0.1); backdrop-filter: blur(5px);
            padding: 10px; border-radius: 50%; cursor: pointer;
            transition: all 0.3s ease; opacity: 0;
        }
        .music-control:hover { background: rgba(255,255,255,0.2); }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }
    </style>
</head>
<body class="antialiased selection:bg-pink-500 selection:text-white">

    <!-- Audio Element (Hidden) -->
    <audio id="bg-music" loop>
        <source src="https://cdn.pixabay.com/download/audio/2022/03/24/audio_8845e2081d.mp3" type="audio/mpeg">
    </audio>

    <!-- Intro Overlay -->
    <div id="intro-overlay">
        <div class="glow-point mb-8"></div>
        <p class="text-gray-400 text-sm mb-6 tracking-widest uppercase opacity-70">Put on headphones üéß</p>
        <button onclick="igniteExperience()" class="modern-btn px-8 py-3 rounded-full text-white font-bold tracking-widest uppercase text-sm border border-white/20">
            Ignite the Moment
        </button>
    </div>

    <!-- Layer 1: Aurora -->
    <div class="aurora-bg" id="aurora"></div>

    <!-- Layer 2: Fireflies -->
    <canvas id="firefly-canvas"></canvas>

    <!-- Layer 3: 3D Hearts -->
    <canvas id="heart-canvas"></canvas>

    <!-- UI Overlay -->
    <div class="relative z-10 w-full min-h-screen flex flex-col items-center justify-center p-4 md:p-8" id="main-ui" style="pointer-events: none;">

        <!-- Progress Bar -->
        <div class="fixed top-6 w-32 md:w-64 h-1.5 rounded-full bg-white/10 backdrop-blur-sm overflow-hidden z-50 opacity-0" id="prog-container">
            <div id="progress-bar" class="h-full w-0 progress-fill rounded-full"></div>
        </div>

        <!-- Main Content Area -->
        <main class="w-full max-w-6xl relative min-h-[600px] flex items-center justify-center" style="pointer-events: auto;">

            <!-- STEP 1: Grand Welcome -->
            <div id="step-1" class="step-container flex-col items-center text-center glass-card p-8 md:p-12 rounded-3xl w-full max-w-3xl">
                <div class="text-6xl md:text-7xl mb-6 heart-beat">‚ù§Ô∏è</div>
                <h1 class="text-3xl md:text-5xl font-bold mb-6 text-gradient leading-tight">Hey my maal,</h1>
                
                <div class="space-y-4 text-gray-200 text-sm md:text-base leading-relaxed text-left mb-8 font-light tracking-wide max-h-[55vh] overflow-y-auto pr-2 custom-scroll">
                    <p class="font-bold text-center text-pink-300 text-lg mb-6 border-b border-white/10 pb-4">Happy birthday my precious sunu (Nayanika)</p>
                    <p>There are people who enter our lives quietly, and then there are people like you ‚Äî who change everything without even trying. Before you, I never knew how deeply someone‚Äôs presence could calm my heart. I never knew love could feel this pure, this safe, this endless.</p>
                    <p>You are the softness I didn‚Äôt know I needed, the strength I didn‚Äôt know I had, and the blessing I thank the universe for every single day.</p>
                    <p>On your birthday, I don‚Äôt just wish you happiness‚Ä¶ I wish you every dream you‚Äôve ever held close, every peace you‚Äôve ever searched for, and every bit of love you have given ‚Äî returned to you a hundred times over. I hope life wraps you in warmth, protects your smile, and gives you the beautiful future your soul deserves.</p>
                    <p class="italic text-pink-200 border-l-2 border-pink-500 pl-4 mt-6 bg-pink-500/5 p-4 rounded-r-lg">"Just know this ‚Äî no matter how the world changes, no matter where life takes us, one truth will always stay the same: My heart is yours, deeply, quietly, endlessly‚Ä¶ today, tomorrow, and every lifetime after this one."</p>
                </div>
                
                <button onclick="nextStep(2)" class="modern-btn px-10 py-4 rounded-full text-white font-bold tracking-wider text-sm md:text-base uppercase shadow-lg group">
                    Let's Begin <span class="inline-block group-hover:translate-x-1 transition-transform">‚Üí</span>
                </button>
            </div>

            <!-- STEP 2: Core Message -->
            <div id="step-2" class="step-container flex-col items-center text-center glass-card p-8 md:p-12 rounded-3xl w-full max-w-xl mx-auto">
                <div class="text-6xl md:text-7xl mb-6 animate-bounce">üéâ</div>
                <h2 class="text-3xl md:text-4xl font-bold mb-4 text-gradient">Happy Birthday!</h2>
                <p class="text-gray-300 text-base md:text-lg mb-8 leading-relaxed font-light">
                    Another year of you making the world brighter. Your existence is a gift, and I'm so lucky to witness it.
                </p>
                <button onclick="nextStep(3)" class="modern-btn px-8 py-3 rounded-full text-white font-bold tracking-wider text-sm md:text-base uppercase">There's more...</button>
            </div>

            <!-- STEP 3: Bento Grid (Reasons Why) -->
            <div id="step-3" class="step-container flex-col items-center text-center glass-card p-6 md:p-10 rounded-3xl w-full max-w-3xl">
                <h2 class="text-2xl md:text-4xl font-bold mb-8 text-gradient">A Few Things I Adore About You</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full mb-8 text-left">
                    <!-- Card 1 -->
                    <div class="md:col-span-2 bg-white/5 border border-white/10 p-6 rounded-2xl hover:bg-white/10 transition-all duration-500 hover:shadow-[0_0_30px_rgba(236,72,153,0.2)] group">
                        <h3 class="text-pink-300 font-semibold text-xl mb-2 group-hover:text-pink-200 transition-colors">‚ú® Your Unmatched Kindness</h3>
                        <p class="text-gray-300 text-sm leading-relaxed">The genuine warmth you show to everyone is something truly rare and beautiful. You have a heart of gold.</p>
                    </div>
                    
                    <!-- Card 2 -->
                    <div class="bg-white/5 border border-white/10 p-6 rounded-2xl hover:bg-white/10 transition-all duration-500 hover:-translate-y-1 flex flex-col justify-center items-center text-center">
                        <h3 class="text-pink-300 font-semibold text-xl mb-2">üòä That Smile</h3>
                        <p class="text-gray-300 text-sm">It's a work of art. It lights up my entire world.</p>
                    </div>

                    <!-- Card 3 -->
                    <div class="bg-white/5 border border-white/10 p-6 rounded-2xl hover:bg-white/10 transition-all duration-500 hover:-translate-y-1">
                        <h3 class="text-pink-300 font-semibold text-xl mb-2">üåü Your Radiant Spirit</h3>
                        <p class="text-gray-300 text-sm leading-relaxed">Your passion for life is infectious. Being around you makes everything feel more exciting.</p>
                    </div>
                </div>

                <button onclick="nextStep(4)" class="modern-btn px-8 py-3 rounded-full text-white font-bold tracking-wider text-sm md:text-base uppercase">Remember this?</button>
            </div>

            <!-- STEP 4: Shared Memories (Gallery) -->
            <div id="step-4" class="step-container flex-col items-center text-center glass-card p-8 md:p-12 rounded-3xl w-full max-w-5xl">
                <h2 class="text-3xl md:text-4xl font-bold mb-8 text-gradient">Moments I Cherish...</h2>
                
                <div class="memories-grid" id="gallery-container">
                    
                    <!-- Photo 1 -->
                    <div class="polaroid-wrapper" data-tilt>
                        <div class="polaroid-card">
                            <img src="C:\Users\sunny saha\OneDrive\Desktop\mylove2.jpg">
                            <div class="text-center"><p class="handwritten">That endless joy</p></div>
                        </div>
                    </div>

                    <!-- Photo 2 -->
                    <div class="polaroid-wrapper" data-tilt>
                        <div class="polaroid-card">
                            <img src="C:\Users\sunny saha\OneDrive\Desktop\mylove3.jpg">
                            <div class="text-center"><p class="handwritten">The adventures</p></div>
                        </div>
                    </div>

                    <!-- Photo 3 -->
                    <div class="polaroid-wrapper" data-tilt>
                        <div class="polaroid-card">
                            <img src="C:\Users\sunny saha\OneDrive\Desktop\mylove4.jpg">
                            <div class="text-center"><p class="handwritten">Your radiant light</p></div>
                        </div>
                    </div>

                    <!-- Photo 4 (Original) -->
                    <div class="polaroid-wrapper" data-tilt>
                        <div class="polaroid-card">
                            <img src="C:\Users\sunny saha\OneDrive\Desktop\mylove1.jpg">
                            <div class="text-center"><p class="handwritten">Our favorite memory ‚ù§Ô∏è</p></div>
                        </div>
                    </div>

                </div>

                <p class="text-gray-300 text-base italic mb-8">"Every moment with you feels like a scene from a movie I'd watch on repeat."</p>
                <button onclick="nextStep(5)" class="modern-btn px-8 py-3 rounded-full text-white font-bold tracking-wider text-sm md:text-base uppercase">One last thing...</button>
            </div>

            <!-- STEP 5: Finale -->
            <div id="step-5" class="step-container flex-col items-center text-center glass-card p-8 md:p-12 rounded-3xl w-full max-w-3xl">
                <div class="text-6xl md:text-7xl mb-6 heart-beat">üéÇ</div>
                <h2 class="text-3xl md:text-4xl font-bold mb-4 text-gradient">My Wish For You</h2>
                <p class="text-gray-300 text-lg mb-8 leading-relaxed font-light max-w-lg mx-auto">
                    May the next year bring you all the love, success, and pure happiness you so rightfully deserve. May your dreams soar higher than ever.
                </p>
                
                <!-- Typewriter Container -->
                <div id="final-message-container" class="h-24 mb-6 flex items-center justify-center w-full">
                    <h2 id="typewriter-text" class="text-2xl md:text-4xl font-bold text-pink-400 drop-shadow-[0_0_15px_rgba(236,72,153,0.6)]"></h2>
                    <span id="cursor" class="text-2xl md:text-4xl font-light text-white animate-pulse">|</span>
                </div>

                <button id="celebrate-btn" onclick="triggerFinale()" class="modern-btn px-12 py-4 rounded-full text-white font-bold tracking-wider text-lg uppercase shadow-[0_0_20px_rgba(236,72,153,0.4)] hover:shadow-[0_0_50px_rgba(236,72,153,0.8)] hover:scale-105 transition-all">Celebrate!</button>
            </div>

        </main>

        <!-- Music Toggle -->
        <div class="music-control" onclick="toggleMusic()" id="music-btn">
            üîä
        </div>
    </div>

    <script>
        /* --- 0. INIT & INTRO --- */
        gsap.registerPlugin(TextPlugin);
        const audio = document.getElementById('bg-music');
        let isMusicPlaying = false;

        function igniteExperience() {
            // 1. Fade out intro
            const overlay = document.getElementById('intro-overlay');
            overlay.style.opacity = '0';
            setTimeout(() => overlay.style.display = 'none', 1500);

            // 2. Play Music
            audio.volume = 0.4;
            audio.play().then(() => {
                isMusicPlaying = true;
            }).catch(err => console.log("Audio autoplay failed:", err));
            document.getElementById('music-btn').style.opacity = '1';

            // 3. Reveal Backgrounds
            document.getElementById('aurora').style.opacity = '0.8';
            document.getElementById('heart-canvas').style.opacity = '1';

            // 4. Animate in Step 1
            const step1 = document.getElementById('step-1');
            step1.style.display = 'flex';
            gsap.fromTo(step1, 
                { opacity: 0, y: 50, scale: 0.9 },
                { opacity: 1, y: 0, scale: 1, duration: 1.5, ease: "power3.out", delay: 0.5 }
            );
            
            // 5. Show Progress Bar
            gsap.to("#prog-container", { opacity: 1, duration: 1, delay: 0.5 });
        }

        function toggleMusic() {
            const btn = document.getElementById('music-btn');
            if(isMusicPlaying) {
                audio.pause();
                btn.innerText = 'üîá';
            } else {
                audio.play();
                btn.innerText = 'üîä';
            }
            isMusicPlaying = !isMusicPlaying;
        }

        /* --- 1. NAVIGATION LOGIC --- */
        let currentStep = 1;
        const totalSteps = 5;

        const progressBar = document.getElementById('progress-bar');
        const updateProgress = (step) => {
            const percentage = (step / totalSteps) * 100;
            progressBar.style.width = `${percentage}%`;
        };
        updateProgress(1); 

        function nextStep(stepNumber) {
            const currentEl = document.getElementById(`step-${currentStep}`);
            const nextEl = document.getElementById(`step-${stepNumber}`);

            if (!nextEl) return;

            // Cinematic Exit
            gsap.to(currentEl, {
                opacity: 0,
                y: -40,
                scale: 0.9,
                duration: 0.6,
                ease: "power2.in",
                onComplete: () => {
                    currentEl.classList.remove('active');
                    currentEl.style.display = 'none';
                    
                    nextEl.style.display = 'flex';
                    nextEl.classList.add('active');
                    
                    // Cinematic Entry
                    gsap.fromTo(nextEl, 
                        { opacity: 0, y: 40, scale: 0.95 },
                        { opacity: 1, y: 0, scale: 1, duration: 0.8, ease: "power3.out" }
                    );

                    // Staggered content reveal
                    const children = nextEl.querySelectorAll('h1, h2, h3, p, button, .grid, .text-6xl');
                    gsap.fromTo(children, 
                        { opacity: 0, y: 20 },
                        { opacity: 1, y: 0, duration: 0.6, stagger: 0.1, delay: 0.2 }
                    );
                    
                    // If moving to gallery step, animate polaroids specially
                    if(stepNumber === 4) {
                        gsap.fromTo(".polaroid-wrapper", 
                            { opacity: 0, y: 50, rotation: 0 },
                            { opacity: 1, y: 0, rotation: (i) => (i % 2 === 0 ? -3 : 3), duration: 0.8, stagger: 0.15, delay: 0.4, ease: "back.out(1.5)" }
                        );
                    }
                }
            });

            currentStep = stepNumber;
            updateProgress(currentStep);
        }

        // Initialize Step 1 Animation
        gsap.fromTo("#step-1", 
            { opacity: 0, scale: 0.9, y: 20 },
            { opacity: 1, scale: 1, y: 0, duration: 1, ease: "power3.out" }
        );

        /* --- 2. POLAROID MULTI-TILT --- */
        const polaroidWrappers = document.querySelectorAll('.polaroid-wrapper');

        polaroidWrappers.forEach((wrapper) => {
            const card = wrapper.querySelector('.polaroid-card');
            
            wrapper.addEventListener('mousemove', (e) => {
                const rect = wrapper.getBoundingClientRect();
                const x = e.clientX - rect.left; 
                const y = e.clientY - rect.top; 
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                const rotateX = ((y - centerY) / centerY) * -12; 
                const rotateY = ((x - centerX) / centerX) * 12;

                gsap.to(card, {
                    transform: `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`,
                    duration: 0.1
                });
            });

            wrapper.addEventListener('mouseleave', () => {
                // Reset to original CSS defined rotation
                gsap.to(card, {
                    transform: `perspective(1000px) rotateX(0deg) rotateY(0deg) scale(1)`,
                    duration: 0.5,
                    ease: "elastic.out(1, 0.5)"
                });
            });
        });

        /* --- 3. FIREFLIES --- */
        const fCanvas = document.getElementById('firefly-canvas');
        const fCtx = fCanvas.getContext('2d');
        fCanvas.width = window.innerWidth;
        fCanvas.height = window.innerHeight;

        const fireflies = [];
        for(let i=0; i<50; i++) {
            fireflies.push({
                x: Math.random() * fCanvas.width,
                y: Math.random() * fCanvas.height,
                radius: Math.random() * 2,
                speedX: (Math.random() - 0.5) * 0.5,
                speedY: (Math.random() - 0.5) * 0.5,
                alpha: Math.random(),
                pulseSpeed: Math.random() * 0.05
            });
        }

        function animateFireflies() {
            fCtx.clearRect(0, 0, fCanvas.width, fCanvas.height);
            fireflies.forEach(f => {
                f.x += f.speedX;
                f.y += f.speedY;
                f.alpha += Math.sin(Date.now() * f.pulseSpeed) * 0.01;
                
                if(f.x < 0) f.x = fCanvas.width;
                if(f.x > fCanvas.width) f.x = 0;
                if(f.y < 0) f.y = fCanvas.height;
                if(f.y > fCanvas.height) f.y = 0;

                fCtx.beginPath();
                fCtx.arc(f.x, f.y, f.radius, 0, Math.PI * 2);
                fCtx.fillStyle = `rgba(255, 255, 200, ${Math.abs(f.alpha)})`;
                fCtx.shadowBlur = 10;
                fCtx.shadowColor = "white";
                fCtx.fill();
            });
            requestAnimationFrame(animateFireflies);
        }
        animateFireflies();

        /* --- 4. THREE.JS 3D HEARTS --- */
        const hCanvas = document.getElementById('heart-canvas');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 30;
        const renderer = new THREE.WebGLRenderer({ canvas: hCanvas, alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);

        const x = 0, y = 0;
        const heartShape = new THREE.Shape();
        heartShape.moveTo(x + 5, y + 5);
        heartShape.bezierCurveTo(x + 5, y + 5, x + 4, y, x, y);
        heartShape.bezierCurveTo(x - 6, y, x - 6, y + 7, x - 6, y + 7);
        heartShape.bezierCurveTo(x - 6, y + 11, x - 3, y + 15.4, x + 5, y + 19);
        heartShape.bezierCurveTo(x + 12, y + 15.4, x + 16, y + 11, x + 16, y + 7);
        heartShape.bezierCurveTo(x + 16, y + 7, x + 16, y, x + 10, y);
        heartShape.bezierCurveTo(x + 7, y, x + 5, y + 5, x + 5, y + 5);

        const geometry = new THREE.ExtrudeGeometry(heartShape, { depth: 1, bevelEnabled: true, bevelSegments: 2, steps: 2, bevelSize: 1, bevelThickness: 1 });
        const material = new THREE.MeshPhongMaterial({ color: 0xec4899, emissive: 0x500724, specular: 0xffffff, shininess: 50, transparent: true, opacity: 0.9 });

        const hearts3D = [];
        for(let i=0; i<25; i++) {
            const mesh = new THREE.Mesh(geometry, material);
            mesh.position.set((Math.random()-0.5)*70, (Math.random()-0.5)*60, (Math.random()-0.5)*30 - 10);
            mesh.scale.setScalar(Math.random() * 0.03 + 0.01);
            mesh.rotation.x = Math.PI; 
            mesh.rotation.z = Math.random() * Math.PI;
            mesh.userData = { speedY: Math.random()*0.02 + 0.01, wobble: Math.random()*Math.PI*2, isFlying: false };
            scene.add(mesh);
            hearts3D.push(mesh);
        }

        const pointLight = new THREE.PointLight(0xffffff, 1);
        pointLight.position.set(20, 20, 20);
        scene.add(pointLight);
        const ambientLight = new THREE.AmbientLight(0xffb6c1, 0.6);
        scene.add(ambientLight);

        function animate3D() {
            requestAnimationFrame(animate3D);
            const time = Date.now() * 0.001;
            hearts3D.forEach(h => {
                if(h.userData.isFlying) {
                    h.position.y += 0.3;
                    h.position.x += Math.sin(time * 3 + h.userData.wobble) * 0.1;
                    h.rotation.y += 0.1;
                    h.material.opacity -= 0.01;
                } else {
                    h.position.y += Math.sin(time + h.userData.wobble) * 0.02;
                    h.rotation.y += 0.005;
                    h.rotation.z = Math.PI + Math.sin(time + h.userData.wobble) * 0.1;
                }
            });
            renderer.render(scene, camera);
        }
        animate3D();

        /* --- 5. FINALE --- */
        function triggerFinale() {
            const btn = document.getElementById('celebrate-btn');
            
            gsap.to(btn, { scale: 0.9, opacity: 0, duration: 0.5, onComplete: () => { btn.style.display = 'none'; } });

            gsap.to("#cursor", { opacity: 0, repeat: -1, yoyo: true, duration: 0.5 });
            gsap.to("#typewriter-text", {
                text: "Happy Birthday, my crush! ‚ù§Ô∏è",
                duration: 3,
                delay: 0.5,
                ease: "none",
                onComplete: () => {
                     document.getElementById('cursor').style.display = 'none';
                     gsap.to("#typewriter-text", { scale: 1.1, duration: 1, yoyo: true, repeat: -1 });
                }
            });

            fireConfetti();
            hearts3D.forEach(h => h.userData.isFlying = true);
            
            if(isMusicPlaying) {
                gsap.to(audio, {volume: 0.8, duration: 3});
            }
        }

        function fireConfetti() {
            const end = Date.now() + 5000;
            const colors = ['#ec4899', '#db2777', '#fbbf24', '#ffffff'];

            (function frame() {
                confetti({
                    particleCount: 5,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    colors: colors
                });
                confetti({
                    particleCount: 5,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: colors
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            }());

            setTimeout(() => {
                const heart = confetti.shapeFromText({ text: '‚ù§Ô∏è', scalar: 3 });
                confetti({
                    shapes: [heart],
                    scalar: 3,
                    particleCount: 40,
                    spread: 100,
                    origin: { y: 0.4 },
                    startVelocity: 40
                });
            }, 2500);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            fCanvas.width = window.innerWidth;
            fCanvas.height = window.innerHeight;
        });
    </script>
</body>
</html>